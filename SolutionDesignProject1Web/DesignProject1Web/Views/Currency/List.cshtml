@* Views/Currency/List.cshtml *@
@{
    ViewData["Title"] = "Lista de Divisas";
}
<link rel="stylesheet" href="~/css/List.css">

<!-- Librería para gráfico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Navbar -->
<nav class="navbar">
    <!-- Redirecciones a otras páginas de la app -->
    <div class="navbar-left">
        <button class="nav-button">Conversor</button>
        <button class="nav-button">Favoritas</button>
    </div>

    <!-- Selección de idioma y perfil -->
    <div class="navbar-right">
        <button class="profile-button">Perfil</button>
        <select class="language-selector">
            <option selected>Español</option>
            <option>Inglés</option>
        </select>
    </div>
</nav>

<!-- Div principal -->
<div class="main-container">
    <div class="content-wrapper">
        <!-- Lista de Divisas -->
        <div class="currency-list">
            <h3>Buscar divisas</h3>
            <input type="text" placeholder="Buscar divisas..." class="search-bar">

            <!-- Divisas cargadas -->
            <div class="currency-items">
                <div class="currency-item" data-currency="USD" data-values="[65, 59, 80, 81, 56, 55, 40]">
                    <strong>Dólar</strong><br>USD - 0.00
                </div>
                <div class="currency-item" data-currency="CRC" data-values="[45, 49, 60, 71, 66, 65, 50]">
                    <strong>Colón Costarricense</strong><br>CRC - 0.00
                </div>
                <div class="currency-item" data-currency="EUR" data-values="[85, 79, 70, 91, 86, 85, 90]">
                    <strong>EURO</strong><br>EUR - 0.00
                </div>
                <div class="currency-item" data-currency="ARS" data-values="[25, 29, 40, 51, 36, 35, 30]">
                    <strong>Peso Argentino</strong><br>ARS - 0.00
                </div>
                <div class="currency-item" data-currency="SYP" data-values="[5, 9, 10, 11, 16, 15, 10]">
                    <strong>Libra Siria</strong><br>SYP - 0.00
                </div>
            </div>
        </div>

        <!-- Contenedor del gráfico -->
        <div class="chart-container">
            <h3>Divisa seleccionada</h3>
            <!-- Canvas para el gráfico -->
            <canvas id="currencyChart"></canvas>
        </div>>
    </div>
</div>

<script>

    // Filtrar divisas por busqueda
    document.querySelector('.search-bar').addEventListener('input', function() {
        const query = this.value.toLowerCase();
        const currencyItems = document.querySelectorAll('.currency-item');

        currencyItems.forEach(item => {
            const currencyName = item.textContent.toLowerCase();
            if (currencyName.includes(query)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    });

    // Config inicial del gráfico
    const labels = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio"];
    const data = {
        labels: labels,
        datasets: [{
            label: 'Divisa seleccionada',
            data: [65, 59, 80, 81, 56, 55, 40],
            fill: false,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }]
    };

    const config = {
        type: 'line',
        data: data,
    };

    // Se crea una instancia de grafico al cargar la pagina
    let currencyChart;
    window.onload = function() {
        const ctx = document.getElementById('currencyChart').getContext('2d');
        currencyChart = new Chart(ctx, config);

        // Cada elemento divisa en el div izquierdo 
        const currencyItems = document.querySelectorAll('.currency-item');
        currencyItems.forEach(item => {
            item.addEventListener('click', function() {
                const currencyName = this.getAttribute('data-currency');
                const currencyValues = JSON.parse(this.getAttribute('data-values'));

                currencyChart.data.datasets[0].data = currencyValues;
                currencyChart.data.datasets[0].label = currencyName;
                currencyChart.update();

                // El gráfico cambia de titulo depende del nombre de la moneda seleccionada
                document.getElementById('chart-title').innerText = `Gráfico de ${currencyName}`;
            });
        });
    };

</script>